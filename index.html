<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CodeChat | Pro Console</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&family=JetBrains+Mono&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #3b82f6; --danger: #f43f5e; --success: #22c55e; --bg: #050506; --sidebar: #0f0f12; --card: #16161a; }
        * { box-sizing: border-box; transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); }
        body, html { margin: 0; padding: 0; height: 100vh; background: var(--bg); font-family: 'Plus Jakarta Sans', sans-serif; color: #e4e4e7; overflow: hidden; }

        /* --- Modern Admin Overlay --- */
        #admin-overlay { 
            display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.9); 
            z-index: 9999; align-items: center; justify-content: center; backdrop-filter: blur(20px);
        }
        .admin-window { 
            background: var(--sidebar); border: 1px solid #27272a; width: 850px; height: 600px;
            display: grid; grid-template-columns: 280px 1fr; border-radius: 28px; overflow: hidden;
            box-shadow: 0 0 100px rgba(0,0,0,0.8);
        }
        .admin-aside { background: rgba(255,255,255,0.02); border-right: 1px solid #27272a; padding: 25px; display: flex; flex-direction: column; }
        .admin-main { padding: 25px; display: flex; flex-direction: column; gap: 20px; overflow-y: auto; }

        /* --- Server Logs --- */
        #server-logs { 
            flex: 1; background: #000; border: 1px solid #222; border-radius: 12px; 
            font-family: 'JetBrains Mono'; font-size: 11px; padding: 15px; overflow-y: auto; color: #71717a;
        }
        .log-entry { margin-bottom: 5px; border-left: 2px solid #333; padding-left: 8px; }
        .log-time { color: var(--primary); margin-right: 8px; }

        /* --- Chat Layout --- */
        #main-layout { display: grid; grid-template-columns: 300px 1fr; height: 100vh; display: none; }
        #sidebar { background: var(--sidebar); border-right: 1px solid #27272a; padding: 30px; display: flex; flex-direction: column; }
        #chat-view { display: flex; flex-direction: column; background: var(--bg); position: relative; }
        #chat-logs { flex: 1; overflow-y: auto; padding: 40px; display: flex; flex-direction: column; gap: 12px; }
        
        /* --- Message Styling --- */
        .msg { padding: 14px 20px; border-radius: 18px; background: var(--card); border: 1px solid #222; max-width: 75%; align-self: flex-start; }
        .msg.me { align-self: flex-end; background: var(--primary); color: white; border: none; }
        .sender { font-size: 10px; font-weight: 800; opacity: 0.8; margin-bottom: 4px; text-transform: uppercase; letter-spacing: 0.5px; }

        /* --- Buttons & Inputs --- */
        input { background: rgba(0,0,0,0.3); border: 1px solid #333; border-radius: 12px; padding: 14px; color: #fff; outline: none; width: 100%; }
        input:focus { border-color: var(--primary); background: #000; }
        .btn { background: var(--primary); color: white; border: none; padding: 12px 20px; border-radius: 12px; font-weight: 700; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(59, 130, 246, 0.3); }
        .btn-red { background: var(--danger); }
        .btn-sub { background: #27272a; color: #a1a1aa; font-size: 12px; }

        #broadcast-banner { 
            display: none; position: fixed; top: 30px; left: 50%; transform: translateX(-50%);
            background: var(--danger); padding: 14px 40px; border-radius: 100px;
            z-index: 10000; font-weight: 800; animation: slideDown 0.4s cubic-bezier(0.18, 0.89, 0.32, 1.28);
        }
        @keyframes slideDown { from { top: -50px; opacity: 0; } to { top: 30px; opacity: 1; } }

        .status-dot { width: 8px; height: 8px; border-radius: 50%; display: inline-block; margin-right: 6px; background: var(--success); }
        #fx-canvas { position: fixed; inset: 0; pointer-events: none; z-index: 9500; }
    </style>
</head>
<body>

<canvas id="fx-canvas"></canvas>
<div id="broadcast-banner">ðŸ“¢ <span id="bc-text"></span></div>

<div id="admin-overlay">
    <div class="admin-window">
        <div class="admin-aside">
            <h3 style="margin:0 0 20px;">Fleet Control</h3>
            <div id="user-list-admin" style="flex:1; overflow-y:auto;"></div>
            <div style="padding-top:20px; border-top:1px solid #333;">
                <div style="font-size:10px; color:#555; margin-bottom:5px;">SESSION NODES</div>
                <div id="player-count" style="font-weight:900; color:var(--success); font-size:24px;">0</div>
            </div>
        </div>
        <div class="admin-main">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <h3 style="margin:0;">Server Event Logs</h3>
                <button class="btn btn-sub" onclick="toggleAdmin()">Close Console</button>
            </div>
            
            <div id="server-logs"></div>

            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                <input type="text" id="bc-input" placeholder="Broadcast notification..." style="grid-column: span 2;">
                <button class="btn btn-red" onclick="adminCmd('bc')">Execute Global Alert</button>
                <button class="btn" style="background:#fbbf24; color:#000" onclick="adminCmd('rain')">Trigger Coin Rain</button>
                <button class="btn" style="background:#8b5cf6" onclick="adminCmd('matrix')">Inject Matrix Code</button>
                <button class="btn btn-sub" onclick="adminCmd('wipe')">Clear Local History</button>
                <button class="btn btn-red" onclick="adminCmd('kill')">Terminate All Nodes</button>
            </div>
        </div>
    </div>
</div>

<div id="login-screen" style="position:fixed; inset:0; background:var(--bg); z-index:10001; display:flex; align-items:center; justify-content:center;">
    <div style="width:340px; text-align:center; background:var(--card); padding:40px; border-radius:32px; border:1px solid #222;">
        <h1 style="margin-bottom:10px; font-weight:900; letter-spacing:-1px;">CodeChat<span style="color:var(--primary);">.</span></h1>
        <p style="font-size:12px; color:#555; margin-bottom:30px;">P2P Encrypted Messaging</p>
        <input type="text" id="u-name" placeholder="Display Name" style="margin-bottom:10px;">
        <input type="password" id="u-pass" placeholder="Admin Key">
        <button class="btn" style="width:100%; margin-top:20px;" onclick="initSession()">Initialize Link</button>
    </div>
</div>

<div id="main-layout">
    <div id="sidebar">
        <h2 style="font-weight:900; margin:0 0 30px;">CodeChat</h2>
        <button class="btn btn-red" id="adm-trigger" style="display:none; margin-bottom:20px;" onclick="toggleAdmin()">ADMIN CONSOLE</button>
        
        <label style="font-size:10px; color:#555; font-weight:800; letter-spacing:1px;">CONNECT</label>
        <input type="text" id="target-id" style="margin:10px 0;" placeholder="Target Peer ID">
        <button class="btn" style="width:100%;" onclick="joinPeer()">Establish Tunnel</button>

        <div style="margin-top:auto;">
            <div style="display:flex; align-items:center; margin-bottom:10px;">
                <span class="status-dot"></span>
                <span style="font-size:11px; font-weight:800; color:#555;">SYSTEM ACTIVE</span>
            </div>
            <div id="my-id-box" style="font-family:'JetBrains Mono'; color:var(--primary); font-weight:800; font-size:22px; background:#000; padding:15px; border-radius:12px; border:1px solid #222; text-align:center;">------</div>
        </div>
    </div>

    <div id="chat-view">
        <div id="chat-logs"></div>
        <div style="padding:30px; background:rgba(15,15,18,0.8); backdrop-filter:blur(10px); display:flex; gap:15px; border-top:1px solid #222;">
            <input type="text" id="msg-input" placeholder="Secure transmission...">
            <button class="btn" style="width:140px;" onclick="sendData()">SEND</button>
        </div>
    </div>
</div>

<script>
    const d=document, KEY = "AdminBingkahu2014!";
    let user="", isAdmin=false, myPeer, connections = {};

    const audio = new (window.AudioContext || window.webkitAudioContext)();
    function notify(f, d) {
        const o=audio.createOscillator(), g=audio.createGain();
        o.connect(g); g.connect(audio.destination);
        o.frequency.value = f; g.gain.setValueAtTime(0.1, audio.currentTime);
        g.gain.exponentialRampToValueAtTime(0.01, audio.currentTime+d);
        o.start(); o.stop(audio.currentTime+d);
    }

    function addLog(msg, color="#71717a") {
        const l = d.getElementById('server-logs');
        const time = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit', second:'2-digit'});
        l.innerHTML += `<div class="log-entry" style="border-color:${color}"><span class="log-time">[${time}]</span> ${msg}</div>`;
        l.scrollTop = l.scrollHeight;
    }

    function initSession() {
        user = d.getElementById('u-name').value || "User";
        if(d.getElementById('u-pass').value === KEY) { isAdmin=true; d.getElementById('adm-trigger').style.display='block'; }
        audio.resume();
        d.getElementById('login-screen').style.display='none';
        d.getElementById('main-layout').style.display='grid';
        
        myPeer = new Peer(Math.random().toString(36).substr(2, 6).toUpperCase());
        myPeer.on('open', id => {
            d.getElementById('my-id-box').innerText = id;
            addLog(`Local node initialized with ID: ${id}`, "#22c55e");
        });
        myPeer.on('connection', c => setupPeer(c));
    }

    function joinPeer() { 
        const tid = d.getElementById('target-id').value.toUpperCase();
        addLog(`Attempting tunnel to ${tid}...`);
        setupPeer(myPeer.connect(tid)); 
    }

    function setupPeer(c) {
        c.on('open', () => {
            connections[c.peer] = { conn: c, name: "Pending..." };
            c.send({type: 'HANDSHAKE', name: user});
            addLog(`Connected to node ${c.peer}`, "#3b82f6");
            refreshAdmin();
        });
        c.on('data', data => {
            if(data.type === 'HANDSHAKE') { 
                connections[c.peer].name = data.name; 
                addLog(`Node ${c.peer} identified as "${data.name}"`);
                refreshAdmin(); 
            }
            if(data.type === 'MSG') { postMsg(data.name, data.text); notify(800, 0.1); }
            if(data.type === 'BC') { triggerBC(data.val); notify(400, 0.5); addLog(`ALERT RECEIVED: ${data.val}`, "#f43f5e"); }
            if(data.type === 'FX') startFx(data.mode);
            if(data.type === 'WIPE') d.getElementById('chat-logs').innerHTML = "";
            if(data.type === 'KILL') { addLog("Termination signal received", "#f43f5e"); setTimeout(()=>location.reload(), 1000); }
        });
        c.on('close', () => { 
            addLog(`Node ${c.peer} disconnected`, "#555");
            delete connections[c.peer]; 
            refreshAdmin(); 
        });
    }

    function refreshAdmin() {
        const list = d.getElementById('user-list-admin');
        const count = d.getElementById('player-count');
        const ids = Object.keys(connections);
        list.innerHTML = "";
        count.innerText = ids.length;
        ids.forEach(id => {
            list.innerHTML += `<div style="display:flex; justify-content:space-between; margin-bottom:10px; font-size:12px;">
                <span>${connections[id].name}</span>
                <button class="btn-red" style="padding:2px 8px; border:none; border-radius:4px; font-size:10px; cursor:pointer;" onclick="kick('${id}')">KICK</button>
            </div>`;
        });
    }

    function adminCmd(type) {
        const val = d.getElementById('bc-input').value;
        addLog(`Executing global command: ${type.toUpperCase()}`, "#fbbf24");
        for(let id in connections) {
            const target = connections[id].conn;
            if(type==='bc') target.send({type:'BC', val});
            if(type==='rain' || type==='matrix') target.send({type:'FX', mode:type});
            if(type==='wipe') target.send({type:'WIPE'});
            if(type==='kill') target.send({type:'KILL'});
        }
        if(type==='bc') triggerBC(val);
        if(type==='rain' || type==='matrix') startFx(type);
        if(type==='wipe') d.getElementById('chat-logs').innerHTML = "";
    }

    function kick(id) { if(connections[id]) connections[id].conn.send({type:'KILL'}); }
    function toggleAdmin() { d.getElementById('admin-overlay').style.display = (d.getElementById('admin-overlay').style.display==='flex') ? 'none' : 'flex'; }
    function triggerBC(v) { d.getElementById('bc-text').innerText = v; d.getElementById('broadcast-banner').style.display='block'; setTimeout(()=>d.getElementById('broadcast-banner').style.display='none', 8000); }
    
    function postMsg(n, t) {
        const b = d.createElement('div');
        b.className = `msg ${n===user ? 'me' : ''}`;
        b.innerHTML = `<div class="sender">${n}</div><div>${t}</div>`;
        d.getElementById('chat-logs').appendChild(b);
        d.getElementById('chat-logs').scrollTop = d.getElementById('chat-logs').scrollHeight;
    }

    function sendData() {
        const i = d.getElementById('msg-input'); if(!i.value) return;
        for(let id in connections) connections[id].conn.send({type:'MSG', name:user, text:i.value});
        postMsg(user, i.value); i.value="";
    }

    const canvas = d.getElementById('fx-canvas'), ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth; canvas.height = window.innerHeight;
    function startFx(m) {
        let p = []; for(let i=0; i<70; i++) p.push({x:Math.random()*canvas.width, y:-Math.random()*1000, s:Math.random()*7+3});
        const draw = () => {
            ctx.clearRect(0,0,canvas.width, canvas.height);
            let active = false;
            p.forEach(it => {
                it.y += it.s; if(it.y < canvas.height+20) active = true;
                ctx.fillStyle = (m==='rain') ? '#fbbf24' : '#22c55e';
                if(m==='rain') { ctx.beginPath(); ctx.arc(it.x, it.y, 5, 0, 7); ctx.fill(); }
                else { ctx.font='15px monospace'; ctx.fillText(String.fromCharCode(0x30A0 + Math.random()*96), it.x, it.y); }
            });
            if(active) requestAnimationFrame(draw);
        }; draw();
    }
    d.getElementById('msg-input').onkeydown = e => { if(e.key==='Enter') sendData(); };
</script>
</body>
</html>
