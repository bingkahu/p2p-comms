<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CodeChat | ADMIN</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&family=JetBrains+Mono&display=swap" rel="stylesheet">
    <style>
        :root { --accent: #3b82f6; --red: #ff4b4b; --gold: #ffd700; --bg: #030303; --panel: #0a0a0a; }
        
        body, html { margin: 0; padding: 0; height: 100vh; background: var(--bg); font-family: 'Inter', sans-serif; color: #fff; overflow: hidden; }

        /* Admin Slide-out Drawer */
        #admin-drawer { 
            position: fixed; top: 0; left: -360px; width: 340px; height: 100vh; 
            background: #080808; border-right: 2px solid var(--red); z-index: 4000; 
            transition: left 0.4s cubic-bezier(0.16, 1, 0.3, 1); padding: 30px;
            box-shadow: 20px 0 80px rgba(0,0,0,0.9); box-sizing: border-box;
            display: flex; flex-direction: column; gap: 20px;
        }
        #admin-drawer.open { left: 0; }
        .close-drawer { align-self: flex-end; cursor: pointer; color: #555; font-size: 24px; font-weight: 900; }

        /* User Management List */
        #user-list { 
            background: #111; border: 1px solid #222; border-radius: 8px; 
            max-height: 150px; overflow-y: auto; margin-top: 10px;
        }
        .user-item { 
            display: flex; justify-content: space-between; align-items: center;
            padding: 8px 12px; border-bottom: 1px solid #222; font-size: 12px;
        }
        .kick-btn { background: var(--red); color: white; border: none; padding: 4px 8px; border-radius: 4px; font-size: 10px; cursor: pointer; font-weight: 700; }

        /* Chat UI Components */
        #container { display: grid; grid-template-columns: 280px 1fr; height: 100vh; display: none; }
        #sidebar { background: var(--panel); border-right: 1px solid #1a1a1a; padding: 25px; display: flex; flex-direction: column; gap: 20px; }
        #chat-arena { display: flex; flex-direction: column; height: 100vh; background: #000; }
        #logs { flex: 1; overflow-y: auto; padding: 30px; display: flex; flex-direction: column; gap: 15px; }
        .msg { padding: 16px; border-radius: 10px; background: rgba(255,255,255,0.03); border-left: 3px solid var(--accent); }
        .sender { font-size: 11px; font-weight: 900; color: var(--accent); margin-bottom: 6px; text-transform: uppercase; }

        #admin-broadcast { 
            display: none; position: fixed; top: 30px; left: 50%; transform: translateX(-50%);
            background: var(--red); padding: 15px 40px; border-radius: 50px;
            z-index: 5000; font-weight: 900; box-shadow: 0 0 40px rgba(255, 75, 75, 0.4);
        }

        #footer { padding: 25px; background: var(--panel); border-top: 1px solid #1a1a1a; display: flex; gap: 15px; }
        input { background: #111; border: 1px solid #222; border-radius: 8px; padding: 14px; color: #fff; outline: none; width: 100%; }
        .btn { background: var(--accent); color: #fff; border: none; padding: 12px; border-radius: 8px; font-weight: 700; cursor: pointer; }
        #fx-canvas { position: fixed; top: 0; left: 0; pointer-events: none; z-index: 3000; }
    </style>
</head>
<body>

<canvas id="fx-canvas"></canvas>
<div id="admin-broadcast">ðŸ“¢ <span id="bc-msg"></span></div>

<div id="admin-drawer">
    <div class="close-drawer" onclick="toggleDrawer()">âœ•</div>
    <h2 style="color:var(--red); font-size: 16px; margin: 0;">ROOT CONSOLE</h2>
    
    <div id="user-mgmt">
        <label style="font-size:10px; color:#555; font-weight: 800;">ACTIVE NODES</label>
        <div id="user-list">
            <div class="user-item" style="color:#444"><i>Waiting for connection...</i></div>
        </div>
    </div>

    <div>
        <label style="font-size:10px; color:#555; font-weight: 800;">REMOTE FX COMMANDS</label>
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-top:10px;">
            <button class="btn" style="background:var(--gold); color:#000" onclick="cmd('rain')">Coin Rain</button>
            <button class="btn" style="background:purple" onclick="cmd('glitch')">Glitch UI</button>
            <button class="btn" style="background:#0f0; color:#000" onclick="cmd('matrix')">Matrix FX</button>
            <button class="btn" style="background:#fff; color:#000" id="freeze-btn" onclick="cmd('freeze')">Mute All</button>
        </div>
    </div>

    <div>
        <label style="font-size:10px; color:#555; font-weight: 800;">GLOBAL ALERT</label>
        <input type="text" id="bc-in" placeholder="Announcement message..." style="margin-top:10px;">
        <button class="btn" style="background:var(--red); width:100%; margin-top:5px;" onclick="cmd('bc')">Send Broadcast</button>
    </div>
</div>

<div id="auth-screen" style="position:fixed; inset:0; background:#000; z-index:9000; display:flex; align-items:center; justify-content:center;">
    <div style="background:var(--panel); padding:50px; border-radius:24px; border:1px solid #1a1a1a; width:340px; text-align:center;">
        <h1 style="font-weight:900;">CodeChat</h1>
        <input type="text" id="l-user" placeholder="Identity" style="margin-bottom:12px;">
        <input type="password" id="l-pass" placeholder="Password" style="margin-bottom:25px;">
        <button class="btn" onclick="auth()" style="width:100%; padding:16px;">Initialize</button>
    </div>
</div>

<div id="container">
    <div id="sidebar">
        <h2 style="font-weight:900; font-size:24px;">Code<span style="color:var(--accent)">Chat</span></h2>
        <button class="btn" id="admin-toggle-btn" style="display:none; background:var(--red);" onclick="toggleDrawer()">ADMIN PANEL</button>
        <div style="margin-top:20px;">
            <label style="font-size:10px; color:#555;">LINK TARGET</label>
            <input type="text" id="peer-join" placeholder="Target ID" style="margin-top:10px;">
            <button class="btn" onclick="connect()" style="width:100%; margin-top:8px;">Connect</button>
        </div>
        <div style="margin-top:auto;">
            <label style="font-size:10px; color:#555;">YOUR ID</label>
            <div id="id-box" style="color:var(--accent); font-weight:900; font-family:monospace;">--------</div>
        </div>
    </div>
    <div id="chat-arena">
        <div id="logs"></div>
        <div id="footer">
            <input type="text" id="msg-in" placeholder="Type here...">
            <button class="btn" id="send-btn" onclick="send()">SEND</button>
        </div>
    </div>
</div>

<script>
    const d=document, aKey = "AdminBingkahu2014!";
    let user="", isAdmin=false, peer, conn, activePeers = {};

    function auth() {
        const u = d.getElementById('l-user').value, p = d.getElementById('l-pass').value;
        if(!u) return; user = u;
        if(p === aKey) { isAdmin=true; d.getElementById('admin-toggle-btn').style.display='block'; }
        d.getElementById('auth-screen').style.display='none';
        d.getElementById('container').style.display='grid';
        init();
    }

    function init() {
        const id = Math.random().toString(36).substr(2, 6).toUpperCase();
        peer = new Peer(id);
        peer.on('open', i => d.getElementById('id-box').innerText = i);
        peer.on('connection', x => { conn = x; setupConn(x); });
    }

    function connect() {
        const target = d.getElementById('peer-join').value.toUpperCase();
        conn = peer.connect(target);
        setupConn(conn);
    }

    function setupConn(c) {
        c.on('open', () => {
            // Send our name to the other person immediately
            c.send({type: 'ID_ANNOUNCE', name: user});
            updateUserList(c.peer, "Connecting...");
        });

        c.on('data', data => {
            if(data.type === 'ID_ANNOUNCE') updateUserList(c.peer, data.name);
            if(data.type === 'BC') showBC(data.val);
            if(data.type === 'KICK') { alert("Kicked by admin"); location.reload(); }
            if(data.type === 'RAIN') startFx('coin');
            if(data.text) addMsg(data.name, data.text);
        });
    }

    function updateUserList(peerId, name) {
        activePeers[peerId] = name;
        const list = d.getElementById('user-list');
        list.innerHTML = "";
        for (let id in activePeers) {
            list.innerHTML += `
                <div class="user-item">
                    <span>${activePeers[id]} (${id})</span>
                    <button class="kick-btn" onclick="kickUser('${id}')">KICK</button>
                </div>`;
        }
    }

    function kickUser(id) {
        if(conn && conn.peer === id) {
            conn.send({type: 'KICK'});
            delete activePeers[id];
            updateUserList();
        }
    }

    function toggleDrawer() { d.getElementById('admin-drawer').classList.toggle('open'); }

    function showBC(val) {
        const bar = d.getElementById('admin-broadcast');
        d.getElementById('bc-msg').innerText = val;
        bar.style.display = 'block';
        setTimeout(() => { bar.style.display = 'none'; }, 10000);
    }

    function cmd(type) {
        if(!isAdmin || !conn) return;
        const v = d.getElementById('bc-in').value;
        if(type==='bc') { conn.send({type:'BC', val:v}); showBC(v); }
        if(type==='rain') { conn.send({type:'RAIN'}); startFx('coin'); }
        // (Other commands follow same logic)
    }

    function addMsg(n, t) {
        const b = d.createElement('div'); b.className = 'msg';
        b.innerHTML = `<div class="sender">${n}</div>${t}`;
        d.getElementById('logs').appendChild(b);
        d.getElementById('logs').scrollTop = d.getElementById('logs').scrollHeight;
    }

    function send() {
        const i = d.getElementById('msg-in');
        if(!i.value || !conn) return;
        conn.send({name: user, text: i.value});
        addMsg(user, i.value);
        i.value = "";
    }

    // Effect logic (Standardized)
    const canvas = d.getElementById('fx-canvas'), ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth; canvas.height = window.innerHeight;
    function startFx(t) {
        let p = []; for(let i=0; i<80; i++) p.push({x:Math.random()*canvas.width, y:-Math.random()*800, s:Math.random()*5+5});
        const draw = () => {
            ctx.clearRect(0,0,canvas.width, canvas.height);
            let live = false;
            p.forEach(c => {
                c.y += c.s; if(c.y < canvas.height+50) live = true;
                ctx.fillStyle = '#ffd700'; ctx.beginPath(); ctx.arc(c.x, c.y, 6, 0, 7); ctx.fill();
            });
            if(live) requestAnimationFrame(draw);
        }; draw();
    }
</script>
</body>
</html>
