<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CodeChat | v4.3 Elite</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&family=JetBrains+Mono&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #3b82f6; --danger: #f43f5e; --success: #22c55e; --bg: #050506; --sidebar: #0f0f12; --panel: #16161a; }
        * { box-sizing: border-box; transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); }
        body, html { margin: 0; padding: 0; height: 100vh; background: var(--bg); font-family: 'Plus Jakarta Sans', sans-serif; color: #ececed; overflow: hidden; }

        /* --- Admin Dashboard --- */
        #admin-modal { 
            display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.95); 
            z-index: 10000; align-items: center; justify-content: center; backdrop-filter: blur(25px);
        }
        .admin-box { 
            background: var(--sidebar); border: 1px solid #27272a; width: 900px; height: 650px;
            display: grid; grid-template-columns: 260px 1fr; border-radius: 32px; overflow: hidden;
            box-shadow: 0 0 80px rgba(0,0,0,0.5);
        }
        .aside-ctrl { background: rgba(255,255,255,0.03); border-right: 1px solid #27272a; padding: 30px; display: flex; flex-direction: column; }
        .main-ctrl { padding: 30px; display: flex; flex-direction: column; gap: 20px; }

        /* --- Components --- */
        #log-window { 
            flex: 1; background: #000; border: 1px solid #222; border-radius: 16px; 
            font-family: 'JetBrains Mono'; font-size: 11px; padding: 20px; overflow-y: auto; color: #a1a1aa;
        }
        .log-line { margin-bottom: 6px; padding-bottom: 6px; border-bottom: 1px solid #111; }
        .log-ts { color: var(--primary); font-weight: 800; margin-right: 10px; }

        /* --- Chat Interface --- */
        #app-shell { display: grid; grid-template-columns: 320px 1fr; height: 100vh; display: none; }
        #nav-bar { background: var(--sidebar); border-right: 1px solid #27272a; padding: 35px; display: flex; flex-direction: column; }
        #chat-stage { display: flex; flex-direction: column; background: var(--bg); position: relative; }
        #message-stream { flex: 1; overflow-y: auto; padding: 40px; display: flex; flex-direction: column; gap: 15px; }
        
        .bubble { padding: 15px 22px; border-radius: 20px; background: var(--panel); border: 1px solid #222; max-width: 70%; align-self: flex-start; }
        .bubble.me { align-self: flex-end; background: var(--primary); color: white; border: none; box-shadow: 0 10px 20px rgba(59, 130, 246, 0.2); }
        .tag { font-size: 10px; font-weight: 800; opacity: 0.6; margin-bottom: 5px; text-transform: uppercase; letter-spacing: 1px; }

        input { background: #000; border: 1px solid #333; border-radius: 14px; padding: 15px; color: #fff; outline: none; width: 100%; font-size: 14px; }
        input:focus { border-color: var(--primary); }
        
        .btn { background: var(--primary); color: white; border: none; padding: 14px 24px; border-radius: 14px; font-weight: 700; cursor: pointer; transition: 0.3s; }
        .btn:hover { transform: scale(1.02); filter: brightness(1.1); }
        .btn-danger { background: var(--danger); }
        .btn-ghost { background: #27272a; color: #a1a1aa; }

        #alert-strip { 
            display: none; position: fixed; top: 0; left: 0; width: 100%;
            background: var(--danger); padding: 12px; text-align: center;
            z-index: 9999; font-weight: 800; font-size: 14px; text-transform: uppercase;
        }

        .stat-card { background: #000; padding: 15px; border-radius: 14px; border: 1px solid #222; }
        #fx-layer { position: fixed; inset: 0; pointer-events: none; z-index: 9000; }
    </style>
</head>
<body>

<canvas id="fx-layer"></canvas>
<div id="alert-strip">SYSTEM ALERT: <span id="alert-msg"></span></div>

<div id="admin-modal">
    <div class="admin-box">
        <div class="aside-ctrl">
            <h2 style="margin:0 0 5px;">Fleet</h2>
            <p style="font-size:11px; color:#555; margin-bottom:25px;">Live Node Management</p>
            
            <div class="stat-card">
                <div style="font-size:10px; color:#555;">ACTIVE NODES</div>
                <div id="count-num" style="font-size:32px; font-weight:900; color:var(--success);">0</div>
            </div>

            <div id="node-list" style="margin-top:20px; flex:1; overflow-y:auto;"></div>
            
            <button class="btn btn-ghost" style="width:100%; margin-top:20px;" onclick="toggleAdmin(false)">Close Console</button>
        </div>
        <div class="main-ctrl">
            <h3 style="margin:0;">Event Intelligence</h3>
            <div id="log-window"></div>

            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:12px;">
                <input type="text" id="bc-field" placeholder="Enter global transmission..." style="grid-column: span 2;">
                <button class="btn btn-danger" onclick="runGlobal('bc')">Execute Broadcast</button>
                <button class="btn" style="background:#fbbf24; color:#000;" onclick="runGlobal('rain')">ðŸ’° Coin Rain</button>
                <button class="btn" style="background:#a855f7" onclick="runGlobal('matrix')">ðŸ§¬ Matrix Inject</button>
                <button class="btn btn-ghost" onclick="runGlobal('wipe')">Wipe History</button>
                <button class="btn btn-danger" onclick="runGlobal('kill')">ðŸ’€ Kill Session</button>
            </div>
        </div>
    </div>
</div>

<div id="entry-gate" style="position:fixed; inset:0; background:var(--bg); z-index:10001; display:flex; align-items:center; justify-content:center;">
    <div style="width:360px; text-align:center; background:var(--panel); padding:50px; border-radius:40px; border:1px solid #222;">
        <h1 style="margin-bottom:8px; font-weight:900; letter-spacing:-1.5px; font-size:32px;">CodeChat<span style="color:var(--primary);">.</span></h1>
        <p style="font-size:12px; color:#555; margin-bottom:35px;">Secure Mesh Networking</p>
        <input type="text" id="inp-name" placeholder="Username" style="margin-bottom:12px;">
        <input type="password" id="inp-key" placeholder="Admin Key (Optional)">
        <button class="btn" style="width:100%; margin-top:25px;" onclick="startApp()">Enter Terminal</button>
    </div>
</div>

<div id="app-shell">
    <div id="nav-bar">
        <h2 style="font-weight:900; margin:0 0 35px; letter-spacing:-1px;">CodeChat</h2>
        
        <button class="btn btn-danger" id="admin-btn" style="display:none; margin-bottom:25px;" onclick="toggleAdmin(true)">ADMIN CONSOLE</button>
        
        <label style="font-size:10px; color:#555; font-weight:800; letter-spacing:1px;">REMOTE LINK</label>
        <input type="text" id="connect-id" style="margin:10px 0;" placeholder="Target Peer ID">
        <button class="btn" style="width:100%;" onclick="joinLink()">Initialize Tunnel</button>

        <div style="margin-top:auto;">
            <div style="display:flex; align-items:center; margin-bottom:12px;">
                <div style="width:8px; height:8px; border-radius:50%; background:var(--success); margin-right:8px;"></div>
                <span style="font-size:11px; font-weight:800; color:#555;">NODE ONLINE</span>
            </div>
            <div id="id-display" style="font-family:'JetBrains Mono'; color:var(--primary); font-weight:800; font-size:24px; background:#000; padding:18px; border-radius:16px; border:1px solid #222; text-align:center;">------</div>
        </div>
    </div>

    <div id="chat-stage">
        <div id="message-stream"></div>
        <div style="padding:35px; background:rgba(15,15,18,0.8); backdrop-filter:blur(15px); display:flex; gap:15px; border-top:1px solid #222;">
            <input type="text" id="chat-input" placeholder="Enter secure message...">
            <button class="btn" style="width:130px;" onclick="sendMsg()">SEND</button>
        </div>
    </div>
</div>

<script>
    const d=document, ADMIN_KEY = "AdminBingkahu2014!";
    let me="", priv=false, peer, mesh = {};

    const ac = new (window.AudioContext || window.webkitAudioContext)();
    function sfx(f, t) {
        const o=ac.createOscillator(), g=ac.createGain();
        o.connect(g); g.connect(ac.destination);
        o.frequency.value = f; g.gain.setValueAtTime(0.1, ac.currentTime);
        g.gain.exponentialRampToValueAtTime(0.01, ac.currentTime+t);
        o.start(); o.stop(ac.currentTime+t);
    }

    function addLog(txt, hex="#71717a") {
        const win = d.getElementById('log-window');
        if(!win) return;
        const time = new Date().toLocaleTimeString();
        win.innerHTML += `<div class="log-line" style="border-color:${hex}"><span class="log-ts">[${time}]</span> ${txt}</div>`;
        win.scrollTop = win.scrollHeight;
    }

    function startApp() {
        me = d.getElementById('inp-name').value || "User_" + Math.floor(Math.random()*999);
        if(d.getElementById('inp-key').value === ADMIN_KEY) { 
            priv = true; 
            d.getElementById('admin-btn').style.display = 'block';
        }
        ac.resume();
        d.getElementById('entry-gate').style.display = 'none';
        d.getElementById('app-shell').style.display = 'grid';
        
        peer = new Peer(Math.random().toString(36).substr(2, 6).toUpperCase());
        peer.on('open', id => {
            d.getElementById('id-display').innerText = id;
            if(priv) addLog(`Mesh node active: ${id}`, "#22c55e");
        });
        peer.on('connection', conn => handleMesh(conn));
    }

    function joinLink() {
        const target = d.getElementById('connect-id').value.toUpperCase();
        if(target) handleMesh(peer.connect(target));
    }

    function handleMesh(conn) {
        conn.on('open', () => {
            mesh[conn.peer] = { conn, name: "Connecting..." };
            conn.send({type: 'AUTH', name: me});
            if(priv) addLog(`Tunnel established with ${conn.peer}`, "#3b82f6");
            refreshFleet();
        });
        conn.on('data', data => {
            if(data.type === 'AUTH') { mesh[conn.peer].name = data.name; refreshFleet(); if(priv) addLog(`Peer identified: ${data.name}`); }
            if(data.type === 'CHAT') { renderBubble(data.name, data.text); sfx(800, 0.1); }
            if(data.type === 'ALRT') { showAlert(data.val); sfx(400, 0.6); if(priv) addLog(`BROADCAST: ${data.val}`, "#f43f5e"); }
            if(data.type === 'FX') runFx(data.mode);
            if(data.type === 'WIPE') d.getElementById('message-stream').innerHTML = "";
            if(data.type === 'KILL') location.reload();
        });
        conn.on('close', () => { delete mesh[conn.peer]; refreshFleet(); if(priv) addLog(`Node ${conn.peer} dropped.`); });
    }

    function refreshFleet() {
        const list = d.getElementById('node-list');
        const count = d.getElementById('count-num');
        if(!list) return;
        const ids = Object.keys(mesh);
        list.innerHTML = "";
        count.innerText = ids.length;
        ids.forEach(id => {
            list.innerHTML += `<div style="display:flex; justify-content:space-between; margin-bottom:12px; font-size:12px; background:#000; padding:10px; border-radius:10px;">
                <span>${mesh[id].name}</span>
                <button onclick="kick('${id}')" style="color:var(--danger); background:none; border:none; font-weight:800; cursor:pointer;">KICK</button>
            </div>`;
        });
    }

    function runGlobal(type) {
        const val = d.getElementById('bc-field').value;
        if(priv) addLog(`Executing ${type.toUpperCase()}...`, "#fbbf24");
        for(let id in mesh) {
            const m = mesh[id].conn;
            if(type==='bc') m.send({type:'ALRT', val});
            if(type==='rain' || type==='matrix') m.send({type:'FX', mode:type});
            if(type==='wipe') m.send({type:'WIPE'});
            if(type==='kill') m.send({type:'KILL'});
        }
        if(type==='bc') showAlert(val);
        if(type==='rain' || type==='matrix') runFx(type);
        if(type==='wipe') d.getElementById('message-stream').innerHTML = "";
    }

    function kick(id) { if(mesh[id]) mesh[id].conn.send({type:'KILL'}); }
    function toggleAdmin(show) { if(priv) d.getElementById('admin-modal').style.display = show ? 'flex' : 'none'; }
    function showAlert(v) { d.getElementById('alert-msg').innerText = v; d.getElementById('alert-strip').style.display='block'; setTimeout(()=>d.getElementById('alert-strip').style.display='none', 8000); }
    
    function renderBubble(n, t) {
        const b = d.createElement('div');
        b.className = `bubble ${n===me ? 'me' : ''}`;
        b.innerHTML = `<div class="tag">${n}</div><div>${t}</div>`;
        const s = d.getElementById('message-stream');
        s.appendChild(b);
        s.scrollTop = s.scrollHeight;
    }

    function sendMsg() {
        const i = d.getElementById('chat-input'); if(!i.value) return;
        for(let id in mesh) mesh[id].conn.send({type:'CHAT', name:me, text:i.value});
        renderBubble(me, i.value); i.value="";
    }

    const cv = d.getElementById('fx-layer'), cx = cv.getContext('2d');
    cv.width = window.innerWidth; cv.height = window.innerHeight;
    function runFx(m) {
        let p = []; for(let i=0; i<80; i++) p.push({x:Math.random()*cv.width, y:-Math.random()*1000, s:Math.random()*8+4});
        const loop = () => {
            cx.clearRect(0,0,cv.width, cv.height);
            let active = false;
            p.forEach(it => {
                it.y += it.s; if(it.y < cv.height+20) active = true;
                cx.fillStyle = (m==='rain') ? '#fbbf24' : '#22c55e';
                if(m==='rain') { cx.beginPath(); cx.arc(it.x, it.y, 5, 0, 7); cx.fill(); }
                else { cx.font='16px monospace'; cx.fillText(String.fromCharCode(0x30A0 + Math.random()*96), it.x, it.y); }
            });
            if(active) requestAnimationFrame(loop);
        }; loop();
    }
    d.getElementById('chat-input').onkeydown = e => { if(e.key==='Enter') sendMsg(); };
</script>
</body>
</html>
