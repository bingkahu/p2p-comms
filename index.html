/* (c) 2026 Neural Nexus. Unauthorized copying prohibited. See LICENSE file for EULA. */
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>NEURAL NEXUS | SECURE DASHBOARD</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        :root { --blue: #3b82f6; --bg: #000; --panel: #111; --border: #262626; --text: #9ca3af; }
        body, html { margin: 0; padding: 0; height: 100vh; overflow: hidden; background: var(--bg); font-family: sans-serif; color: white; }
        
        /* Auth Screen */
        #auth-screen { position: fixed; z-index: 10000; top: 0; left: 0; width: 100%; height: 100%; background: #000; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .auth-card { background: var(--panel); padding: 30px; border-radius: 8px; border: 1px solid var(--border); width: 300px; display: flex; flex-direction: column; gap: 15px; }
        
        /* Layout */
        #container { display: grid; grid-template-columns: 260px 1fr; height: 100vh; position: relative; z-index: 10; display: none; }
        #sidebar { background: var(--panel); border-right: 1px solid var(--border); padding: 20px; display: flex; flex-direction: column; gap: 15px; }
        
        /* Components */
        .input-group { display: flex; flex-direction: column; gap: 5px; }
        label { font-size: 11px; color: var(--text); font-weight: bold; }
        input { background: #1a1a1a; border: 1px solid var(--border); border-radius: 4px; padding: 10px; color: white; outline: none; }
        .btn { background: var(--blue); color: white; border: none; padding: 12px; border-radius: 4px; font-weight: bold; cursor: pointer; }
        .btn-alt { background: transparent; color: var(--text); border: 1px solid var(--border); padding: 8px; font-size: 12px; cursor: pointer; }

        /* Chat UI */
        #chat-arena { display: flex; flex-direction: column; height: 100vh; }
        #room-header { background: #111; padding: 10px 20px; font-size: 12px; border-bottom: 1px solid var(--border); color: var(--blue); }
        #logs { flex-grow: 1; overflow-y: auto; padding: 10px; display: flex; flex-direction: column; gap: 4px; }
        .msg-bar { width: 100%; padding: 8px 15px; box-sizing: border-box; font-size: 13px; border-radius: 2px; margin-bottom: 2px; }
        .sent { background: #1d4ed8; border-left: 3px solid #60a5fa; }
        .recv { background: #1a1a1a; border-left: 3px solid var(--blue); }
        
        #footer { padding: 12px; border-top: 1px solid var(--border); display: flex; gap: 10px; }
        #id-box { font-family: monospace; color: #fbbf24; background: #222; padding: 8px; border-radius: 4px; text-align: center; margin-top: 5px; }
    </style>
</head>
<body>

<div id="auth-screen">
    <div class="auth-card" id="login-form">
        <h2 style="margin:0; color:var(--blue)">LOGIN</h2>
        <input type="text" id="login-user" placeholder="Username">
        <input type="password" id="login-pass" placeholder="Password">
        <button class="btn" onclick="handleAuth('login')">SIGN IN</button>
        <button class="btn-alt" onclick="toggleAuth(false)">New here? Sign up</button>
    </div>
    <div class="auth-card" id="signup-form" style="display:none">
        <h2 style="margin:0; color:var(--blue)">SIGNUP</h2>
        <input type="text" id="reg-user" placeholder="Create Username">
        <input type="password" id="reg-pass" placeholder="Create Password">
        <button class="btn" onclick="handleAuth('signup')">CREATE ACCOUNT</button>
        <button class="btn-alt" onclick="toggleAuth(true)">Already have an account? Login</button>
    </div>
</div>

<div id="container">
    <div id="sidebar">
        <h2 style="margin:0">CodeChat</h2>
        <div class="input-group">
            <label>LOGGED IN AS</label>
            <div id="current-user-display" style="font-weight:bold">---</div>
        </div>
        <div class="input-group">
            <label>JOIN ROOM (8-DIGIT CODE)</label>
            <input type="text" id="peer-in" placeholder="Enter Code">
        </div>
        <button class="btn" onclick="connect()">Join Room</button>
        <div style="margin-top:auto;">
            <label>YOUR 8-DIGIT NEURAL ID</label>
            <div id="id-box">...</div>
            <button class="btn-alt" style="width:100%; margin-top:10px" onclick="location.reload()">LOGOUT</button>
        </div>
    </div>
    <div id="chat-arena">
        <div id="room-header">SECURE CHANNEL: <span id="room-status">OFFLINE</span></div>
        <div id="logs"></div>
        <div id="footer">
            <input type="text" id="msg-in" placeholder="Type message..." style="flex:1" autocomplete="off">
            <button class="btn" onclick="send()">SEND</button>
        </div>
    </div>
</div>

<script>
(function(){
    const d=document;
    let currentUser = "";
    
    // --- AUTH LOGIC ---
    window.toggleAuth = (showLogin) => {
        d.getElementById('login-form').style.display = showLogin ? 'flex' : 'none';
        d.getElementById('signup-form').style.display = showLogin ? 'none' : 'flex';
    };

    window.handleAuth = (type) => {
        const u = d.getElementById(type === 'login' ? 'login-user' : 'reg-user').value.trim();
        const p = d.getElementById(type === 'login' ? 'login-pass' : 'reg-pass').value.trim();
        if(!u || !p) return alert("Fields cannot be empty");

        let users = JSON.parse(localStorage.getItem('nn_users') || '{}');

        if(type === 'signup') {
            if(users[u]) return alert("Username taken");
            users[u] = p;
            localStorage.setItem('nn_users', JSON.stringify(users));
            alert("Account created! Please login.");
            toggleAuth(true);
        } else {
            if(users[u] && users[u] === p) {
                currentUser = u;
                d.getElementById('auth-screen').style.display = 'none';
                d.getElementById('container').style.display = 'grid';
                d.getElementById('current-user-display').innerText = u;
                initP2P();
            } else {
                alert("Invalid credentials");
            }
        }
    };

    // --- P2P LOGIC ---
    let peer, conn;
    function initP2P() {
        // Generate 8-digit alpha-numeric ID
        const id = Math.random().toString(36).substr(2, 8).toUpperCase();
        peer = new Peer(id);
        
        peer.on('open', i => d.getElementById('id-box').innerText = i);
        peer.on('connection', x => { conn = x; setupConn(); });
    }

    window.connect = () => {
        const rid = d.getElementById('peer-in').value.toUpperCase();
        if(!rid) return;
        conn = peer.connect(rid);
        setupConn();
    };

    function setupConn() {
        conn.on('open', () => d.getElementById('room-status').innerText = "CONNECTED TO " + conn.peer);
        conn.on('data', data => add(data.text, 'recv', data.name));
    }

    function add(text, type, sender) {
        const b = d.createElement('div');
        b.className = `msg-bar ${type}`;
        b.innerHTML = `<div style="font-size:10px; opacity:0.6">${sender}</div>${text}`;
        d.getElementById('logs').appendChild(b);
        d.getElementById('logs').scrollTop = d.getElementById('logs').scrollHeight;
    }

    window.send = () => {
        const i = d.getElementById('msg-in');
        if(!i.value || !conn) return;
        conn.send({ name: currentUser, text: i.value });
        add(i.value, 'sent', currentUser);
        i.value = "";
    };

    d.getElementById('msg-in').onkeypress = e => { if(e.key==='Enter') send(); };
})();
</script>
</body>
</html>
